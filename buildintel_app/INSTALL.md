# Инструкция по установке и сборке BuildIntel Desktop

## Быстрый запуск (без командной строки)

**Для запуска приложения двойным кликом:**
1. Откройте папку `buildintel_app`
2. Дважды кликните на файл **`Запустить_BuildIntel.bat`** или **`START.bat`**
3. Приложение запустится автоматически

**Важно:** Перед запуском убедитесь, что бэкенд FastAPI запущен (см. раздел "Запуск бэкенда" ниже)

## Быстрый старт

### 1. Установка зависимостей

**Важно:** Вы можете установить зависимости либо глобально, либо в виртуальное окружение.

**Вариант А: Автоматическая установка (рекомендуется)**
```bash
cd buildintel_app
# Дважды кликните на УСТАНОВИТЬ_ЗАВИСИМОСТИ.bat
# или в терминале:
.\УСТАНОВИТЬ_ЗАВИСИМОСТИ.bat
```

**Вариант Б: Глобальная установка вручную**
```bash
cd buildintel_app
pip install -r requirements.txt
```

**Вариант В: В виртуальное окружение (рекомендуется для разработки)**
```bash
# Создайте виртуальное окружение (если еще не создано)
python -m venv venv

# Активируйте его
# Windows PowerShell:
.\venv\Scripts\Activate.ps1
# Windows Command Prompt:
venv\Scripts\activate

# Установите зависимости
cd buildintel_app
pip install -r requirements.txt
```

**Примечание:** 
- Если зависимости установлены глобально, вы можете запускать `python main.py` без активации venv
- Если возникает ошибка "ModuleNotFoundError" - дважды кликните на `УСТАНОВИТЬ_ЗАВИСИМОСТИ.bat`

### 2. Запуск приложения

**Важно:** Десктопное приложение требует запущенный бэкенд FastAPI. Выполните следующие шаги:

#### Шаг 2.1: Запуск бэкенда FastAPI

1. Откройте терминал (PowerShell или Command Prompt)

2. Перейдите в корневую директорию проекта:
```bash
cd C:\Users\user\Desktop\Проекты\monitor_kp
```

3. Убедитесь, что виртуальное окружение активировано (если используете):
```bash
# Для Windows:
venv\Scripts\activate
```

4. Проверьте, что все зависимости установлены:
```bash
pip install -r requirements.txt
```

5. Проверьте наличие файла `.env` с настройками OpenAI API:
```bash
# Убедитесь, что файл .env существует и содержит:
# OPENAI_API_KEY=your_api_key_here
# OPENAI_MODEL=gpt-4o-mini
# OPENAI_VISION_MODEL=gpt-4o-mini
```

6. Запустите бэкенд сервер:
```bash
python -m uvicorn backend.main:app --reload --host 0.0.0.0 --port 8000
```

7. Дождитесь сообщения в терминале:
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

8. Проверьте, что сервер работает:
   - Откройте браузер и перейдите на http://localhost:8000/docs
   - Должна открыться страница Swagger UI с документацией API
   - Если страница открывается — бэкенд работает корректно

**Важно:** Не закрывайте этот терминал! Сервер должен работать постоянно, пока вы используете десктопное приложение.

#### Шаг 2.2: Запуск десктопного приложения

1. Откройте **новый** терминал (не закрывая терминал с бэкендом)

2. Перейдите в директорию десктопного приложения:
```bash
cd C:\Users\user\Desktop\Проекты\monitor_kp\buildintel_app
```

3. **Если используете venv** - активируйте его:
```bash
# PowerShell:
..\venv\Scripts\Activate.ps1
# Command Prompt:
..\venv\Scripts\activate
```

4. Убедитесь, что зависимости PyQt6 установлены:
```bash
pip install -r requirements.txt
```

5. Запустите приложение:
```bash
python main.py
```

**Примечание:** Если PyQt6 установлен глобально (не в venv), вы можете запускать `python main.py` без активации виртуального окружения. Проверить можно командой:
```bash
python -c "import PyQt6; print('PyQt6 доступен')"
```
Если команда выполняется без ошибок - можно запускать без venv.

5. Должно открыться окно приложения BuildIntel с вкладками:
   - **Анализ текста** — для анализа продающих текстов
   - **Планировки** — для анализа планировок квартир
   - **Парсинг сайта** — для парсинга и анализа сайтов
   - **История** — просмотр истории запросов

#### Шаг 2.3: Проверка работы

1. Перейдите на вкладку "Анализ текста"

2. Введите тестовый текст (например):
```
Жилой комплекс 'Премиум Парк' - это современное жилье в экологически чистом районе. 
Квартиры от 45 до 120 кв.м с отделкой премиум-класса. Срок сдачи - 2 квартал 2025 года.
```

3. Нажмите кнопку "Проанализировать"

4. Дождитесь результата анализа (может занять 10-30 секунд)

5. Если анализ выполнен успешно и отображаются результаты — приложение работает корректно!

#### Возможные проблемы при запуске:

**Проблема:** Ошибка "Connection refused" или "Failed to connect"
- **Решение:** Убедитесь, что бэкенд запущен на порту 8000
- Проверьте, что в терминале с бэкендом нет ошибок
- Попробуйте открыть http://localhost:8000/docs в браузере

**Проблема:** Ошибка "ModuleNotFoundError: No module named 'PyQt6'"
- **Решение:** Установите зависимости: `pip install -r requirements.txt`

**Проблема:** Приложение запускается, но не может выполнить анализ
- **Решение:** 
  - Проверьте, что файл `.env` содержит корректный `OPENAI_API_KEY`
  - Убедитесь, что у вас есть интернет-соединение
  - Проверьте логи бэкенда в терминале

**Проблема:** Окно приложения не открывается
- **Решение:**
  - Проверьте, что Python установлен: `python --version`
  - Убедитесь, что PyQt6 установлен: `python -c "import PyQt6"`
  - Попробуйте запустить с выводом ошибок: `python main.py` (в терминале увидите ошибки)

## Сборка в .exe файл

**Важно:** После сборки в .exe файл виртуальное окружение не потребуется - все зависимости будут включены в исполняемый файл.

### Автоматическая сборка (рекомендуется)

Просто запустите `build.bat`:

```bash
.\build.bat
```

**Примечание:** Для сборки можно использовать как глобально установленные зависимости, так и из venv. PyInstaller соберет все необходимое в .exe файл.

### Ручная сборка

1. Установите PyInstaller (если еще не установлен):
```bash
pip install pyinstaller
```

2. Запустите сборку:
```bash
pyinstaller --name=BuildIntel --onefile --windowed --add-data="ui;ui" --hidden-import=PyQt6.QtCore --hidden-import=PyQt6.QtGui --hidden-import=PyQt6.QtWidgets --hidden-import=api_client --collect-all=PyQt6 --clean --noconfirm main.py
```

3. Исполняемый файл будет находиться в папке `dist/BuildIntel.exe`

## Требования для работы

- **Python 3.9+** (только для разработки, не требуется для .exe)
- **Запущенный бэкенд FastAPI** на http://localhost:8000
- **Windows 7+** (для .exe версии)

## Структура проекта

```
buildintel_app/
├── main.py              # Точка входа приложения
├── api_client.py        # Клиент для работы с API бэкенда
├── ui/                  # UI модули
│   ├── __init__.py
│   ├── main_window.py   # Главное окно с вкладками
│   ├── text_tab.py      # Вкладка анализа текста
│   ├── image_tab.py     # Вкладка анализа планировок
│   ├── parse_tab.py     # Вкладка парсинга сайтов
│   └── history_tab.py   # Вкладка истории запросов
├── requirements.txt     # Python зависимости
├── build.bat           # Скрипт сборки для Windows
├── build_exe_advanced.bat  # Улучшенный скрипт сборки
├── СОЗДАТЬ_EXE.bat     # Скрипт создания .exe
├── ЗАПУСТИТЬ.bat       # Скрипт запуска приложения
├── УСТАНОВИТЬ_ЗАВИСИМОСТИ.bat  # Установка зависимостей
├── README.md           # Документация
├── INSTALL.md          # Подробная инструкция
└── .gitignore          # Git ignore файл
```

## Функционал

Приложение полностью повторяет функционал веб-версии:

1. **Анализ продающих текстов** - маркетинговый анализ текстов в строительстве
2. **Анализ планировок квартир** - оценка удобства планировок, анализ комнат, санузлов, лифтов
3. **Парсинг сайтов** - автоматическое извлечение и анализ контента по URL
4. **История запросов** - сохранение последних 10 запросов

## Устранение проблем

### Ошибка "ModuleNotFoundError: No module named 'PyQt5'"

**Решение:** Дважды кликните на **`УСТАНОВИТЬ_ЗАВИСИМОСТИ.bat`** или выполните:
```bash
pip install PyQt5==5.15.10 requests==2.31.0
```


### Приложение не запускается

- Убедитесь, что бэкенд запущен на http://localhost:8000
- Проверьте, что все зависимости установлены: `pip install -r requirements.txt`
- Проверьте версию Python: `python --version` (должна быть 3.9+)

### Ошибка при сборке .exe

- Убедитесь, что PyInstaller установлен: `pip install pyinstaller`
- Проверьте, что все модули правильно импортированы
- Попробуйте очистить кэш: удалите папки `build/` и `dist/`, затем запустите сборку заново

### Приложение работает, но не может подключиться к API

- Проверьте, что бэкенд запущен: откройте http://localhost:8000/docs в браузере
- Убедитесь, что порт 8000 не занят другим приложением
- Проверьте файрвол и антивирус
- Проверьте, что в `api_client.py` указан правильный `base_url`

## Примечания

- История запросов сохраняется в файл `history.json` в директории приложения
- Для работы парсинга сайтов требуется ChromeDriver (как в веб-версии)
- Приложение использует темную тему для лучшего визуального восприятия
